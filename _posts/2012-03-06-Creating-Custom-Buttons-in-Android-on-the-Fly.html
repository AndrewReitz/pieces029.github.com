---
layout: post
title: Creating Custom Buttons in Android on the Fly
date: 2012-03-06 19:11:27 UTC
updated: 2012-03-06 19:11:27 UTC
comments: false
categories: Android
---

I needed to be able to set the border color of a button or the "stroke" as it's referred to in android on in the code and not the xml, because it was based on a color received from a web service.  Everywhere I looked people were easily creating custom buttons with xml, but these values, at least with what I played with could not be changed on the fly.<br /><br />Now another big issue is that the xml for shapes does not seem to correspond 1 to 1 with their code counter parts.  I can easily create a rectangle with one color as the boarder and another color as the fill in xml not so easy in the code.<br />Here is the solution I came up with for my custom button in code.<br />First I created a custom shape class and override the onDraw method.<br /><br /><code><br />private class CustomRect extends ShapeDrawable<br />{<br />&nbsp; &nbsp; Paint fillpaint, strokepaint;<br />&nbsp; &nbsp; private static final int STROKE_WIDTH = 10;<br /><br />&nbsp; &nbsp; public customRect(Shape s)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; super(s);<br />&nbsp; &nbsp;&nbsp; &nbsp; &nbsp;fillpaint = this.getPaint();<br />&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;strokepaint = new Paint(fillpaint);<br />&nbsp; &nbsp; &nbsp; &nbsp; strokepaint.setStyle(Style.STROKE);<br />&nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;strokepaint.setStrokeWidth(STROKE_WIDTH);<br />&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; &nbsp;fillpaint.setAlpha(128);<br />&nbsp; &nbsp; }<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;@Override<br />&nbsp;&nbsp;&nbsp;&nbsp;protected void onDraw(Shape shape, Canvas canvas, Paint fillpaint)<br />&nbsp; &nbsp; {<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape.draw(canvas, fillpaint);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;shape.draw(canvas, strokepaint);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public void setStrokeColor(int c)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strokepaint.setColor(c);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;public void setFillColor(int c)<br />&nbsp;&nbsp;&nbsp;&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fillpaint.setColor(c);<br /><code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fillpaint.setAlpha(128);<br /><code>&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></code><br /><br />This class is geared very specifically to how I wanted the rectangle to be but should be a good starting point to anyone else trying to do the same.<br /><br />Next create the shapes you want to use for your button.<br /><br /><code><br />Final CustRect cust_rect_enabled = new CustRect(new RectShape());<br />cust_rect_enabled.setStrokeColor(myColor1);<br />cust_rect_enabled.setFillColor(myColor2);<br /></code><br /><br /><code><br />Final CustRect cust_rect_pressed = new CustRect(new RectShape());<br />cust_rect_pressed.setStrokeColor(myColor2);<br />cust_rect_pressed.setFillColor(myColor1);<br /></code><br /><br />Now you want to add these Drawables to a StateListDrawable, in order to handle what the button looks like when it is pressed.<br /><br /><code><br />StateListDrawable state_list_drawable = new StateListDrawable();<br />state_list_drawable.addState(new int[] {android.R.attr.state_pressed}, cust_rect_pressed);<br />state_list_drawable.addState(StateSet.WILD_CARD, cust_rect_enabled);<br /></code><br /><br />This will tell the button what to use depending on what state it is in.  For everything but the pressed event it will be the cust_rect_enabled, when pressed it will be cust_rect_pressed.  This works for what I need it to, but I would image other projects would need other states to be handled as well.  You can find the other states you may want to set in android.R.attr, the ones you will want to use will generally start with state_.  I did play around with a few of these and was having some issues with getting them to do what I wanted, it is very different than the states in the xml setting them to true and false.<br /><br />Lastly you want to add a default regular android button to the layout file you are using, and set the height and width to what you want it as.  Then in the code you get your handle to it the usual way of calling findViewById, and set the background Drawable.<br /><br /><code><br />Button myCustButton = (Button) findViewById(R.id.buttonQuizNextQuestion);<br />myCustButton.setBackgroundDrawable(state_list_drawable);<br /></code><br /><br />And that is all there is to it!